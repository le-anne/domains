"use strict";var A=Object.defineProperty,Z=Object.defineProperties,j=Object.getOwnPropertyDescriptor,B=Object.getOwnPropertyDescriptors,$=Object.getOwnPropertyNames,P=Object.getOwnPropertySymbols;var N=Object.prototype.hasOwnProperty,J=Object.prototype.propertyIsEnumerable;var x=(a,e,t)=>e in a?A(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t,u=(a,e)=>{for(var t in e||(e={}))N.call(e,t)&&x(a,t,e[t]);if(P)for(var t of P(e))J.call(e,t)&&x(a,t,e[t]);return a},y=(a,e)=>Z(a,B(e));var K=(a,e)=>{for(var t in e)A(a,t,{get:e[t],enumerable:!0})},X=(a,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of $(e))!N.call(a,s)&&s!==t&&A(a,s,{get:()=>e[s],enumerable:!(r=j(e,s))||r.enumerable});return a};var Y=a=>X(A({},"__esModule",{value:!0}),a);var i=(a,e,t)=>new Promise((r,s)=>{var n=l=>{try{p(t.next(l))}catch(d){s(d)}},o=l=>{try{p(t.throw(l))}catch(d){s(d)}},p=l=>l.done?r(l.value):Promise.resolve(l.value).then(n,o);p((t=t.apply(a,e)).next())});var le={};K(le,{AUTH_TOKEN_LOCAL_STORAGE_NAME:()=>I,AUTH_TOKEN_LOCAL_STORAGE_PREFIX:()=>G,AuthProvider:()=>k,ChainToPublicRpc:()=>R,DEVICE_SHARE_LOCAL_STORAGE_NAME:()=>T,DEVICE_SHARE_LOCAL_STORAGE_PREFIX:()=>M,EMBEDDED_WALLET_CREATE_WALLET_UI_PATH:()=>ae,EMBEDDED_WALLET_OTP_PATH:()=>ie,EMBEDDED_WALLET_PATH:()=>h,EMBEDDED_WALLET_SET_UP_NEW_DEVICE_UI_PATH:()=>se,PAPER_APP_URL:()=>C,PaperEmbeddedWalletSdk:()=>v,UserStatus:()=>O,UserWalletStatus:()=>f,getPaperOriginUrl:()=>U});module.exports=Y(le);var ee=()=>typeof window!="undefined"&&window.localStorage.getItem("IS_PAPER_DEV")==="true",te=()=>!!(typeof window!="undefined"&&window.location.origin.includes("zeet.app")),re=()=>typeof window!="undefined"&&window.location.origin.includes("paper.xyz"),U=()=>{var a;return ee()?"http://localhost:3000":te()?(a=process==null?void 0:process.env)!=null&&a.ZEET_DEPLOYMENT_URL?`https://${process.env.ZEET_DEPLOYMENT_URL}`:typeof window!="undefined"?window.location.origin:"https://withpaper.com":re()?window.location.origin:"https://withpaper.com"},C=U(),h="/sdk/2022-08-12/embedded-wallet",ie=`${h}/login-with-otp`,ae=`${h}/create-new-wallet-ui`,se=`${h}/set-up-new-device-ui`,G="walletToken",I=a=>`${G}-${a}`,M="a",T=a=>`${M}-${a}`,R={Ethereum:"https://rpc.ankr.com/eth",Goerli:"https://eth-goerli.g.alchemy.com/v2/demo",Mumbai:"https://rpc-mumbai.maticvigil.com",Polygon:"https://rpc-mainnet.maticvigil.com",Avalanche:"https://api.avax.network/ext/bc/C/rpc"};var k=(s=>(s.PAPER_EMAIL_OTP="PaperEmailOTP",s.GOOGLE="Google",s.AUTH0="Auth0",s.CUSTOM_JWT="CustomJWT",s))(k||{});var O=(t=>(t.LOGGED_OUT="Logged Out",t.LOGGED_IN_WALLET_INITIALIZED="Logged In, Wallet Initialized",t))(O||{}),f=(s=>(s.LOGGED_OUT="Logged Out",s.LOGGED_IN_WALLET_UNINITIALIZED="Logged In, Wallet Uninitialized",s.LOGGED_IN_NEW_DEVICE="Logged In, New Device",s.LOGGED_IN_WALLET_INITIALIZED="Logged In, Wallet Initialized",s))(f||{});var Q=new Map,c=class{constructor({clientId:e}){this.isSupported=typeof window!="undefined"&&!!window.localStorage,this.clientId=e}getItem(e){return i(this,null,function*(){var t;return this.isSupported?window.localStorage.getItem(e):(t=Q.get(e))!=null?t:null})}setItem(e,t){return i(this,null,function*(){if(this.isSupported)return window.localStorage.setItem(e,t);Q.set(e,t)})}removeItem(e){return i(this,null,function*(){let t=yield this.getItem(e);return this.isSupported&&t?(window.localStorage.removeItem(e),!0):!1})}saveAuthCookie(e){return i(this,null,function*(){this.setItem(I(this.clientId),e)})}getAuthCookie(){return i(this,null,function*(){return this.getItem(I(this.clientId))})}removeAuthCookie(){return i(this,null,function*(){return this.removeItem(I(this.clientId))})}saveDeviceShare(e){return i(this,null,function*(){this.setItem(T(this.clientId),e)})}getDeviceShare(){return i(this,null,function*(){return this.getItem(T(this.clientId))})}removeDeviceShare(){return i(this,null,function*(){return this.removeItem(T(this.clientId))})}};var H={top:"0px",left:"0px",right:"0px",bottom:"0px"},F=()=>({main:y(u({},H),{position:"fixed",zIndex:"1000",display:"flex",alignItems:"center",justifyContent:"center"}),overlay:y(u({},H),{position:"absolute",backgroundColor:"rgba(0, 0, 0, 0.5)"}),body:{boxShadow:"0px 10px 20px rgba(0, 0, 0, 0.25)",backgroundColor:window.matchMedia("(prefers-color-scheme: dark)").matches?"#2F2F2F":"white",borderRadius:"12px",padding:"16px",position:"relative",maxWidth:"600px",width:"100%",animation:"pew-modal-slideIn 0.2s forwards",height:"375px",maxHeight:"80vh",overflow:"hidden",display:"flex",flexDirection:"column",alignItems:"end"},iframe:{height:"100%",width:"100%",border:"none",backgroundColor:"transparent",position:"fixed",top:"0px",right:"0px",zIndex:"2147483646",display:"none"}});function L(a){return new Promise(e=>{setTimeout(e,a*1e3)})}var b=new Map,_=class{constructor({link:e,iframeId:t,container:r=document.body,iframeStyles:s,onIframeInitialize:n}){this.POLLING_INTERVAL_SECONDS=1.4;this.POST_LOAD_BUFFER_SECONDS=1;let o=document.getElementById(t);if(!o||o.src!=e){if(!o){o=document.createElement("iframe");let d=u(u({},F().iframe),s);Object.assign(o.style,d),o.setAttribute("id",t),r.appendChild(o)}let p="0.0.18";if(!p)throw new Error("Missing SDK_VERSION env var");let l=new URL(e);l.searchParams.set("sdkVersion",p),o.src=l.href,o.setAttribute("data-version",p),o.onload=this.onIframeLoadHandler(o,this.POST_LOAD_BUFFER_SECONDS,n)}this.iframe=o}onIframeLoadedInitVariables(){return i(this,null,function*(){return{}})}onIframeLoadHandler(e,t,r){return()=>i(this,null,function*(){yield new Promise((n,o)=>i(this,null,function*(){var d;let p=new MessageChannel;p.port1.onmessage=W=>{let{data:m}=W;return p.port1.close(),m.success?(b.set(e.src,!0),r&&r(),n(!0)):o(m.error)},yield L(t);let l="initIframe";(d=e==null?void 0:e.contentWindow)==null||d.postMessage({eventType:l,data:yield this.onIframeLoadedInitVariables()},"*",[p.port2])}))})}call(s){return i(this,arguments,function*({procedureName:e,params:t,showIframe:r=!1}){return new Promise((o,p)=>i(this,null,function*(){var d;for(;!b.get(this.iframe.src);)yield L(this.POLLING_INTERVAL_SECONDS);r&&(this.iframe.style.display="block",yield L(.005));let l=new MessageChannel;l.port1.onmessage=W=>i(this,null,function*(){let{data:m}=W;return l.port1.close(),r&&(yield L(.1),this.iframe.style.display="none"),m.success?o(m.data):p(m.error)}),(d=this.iframe.contentWindow)==null||d.postMessage({eventType:e,data:t},"*",[l.port2])}))})}destroy(){b.delete(this.iframe.src)}};var w=class extends _{constructor({clientId:t,customizationOptions:r}){super({iframeId:ne,link:oe({clientId:t,path:h,queryParams:r}).href,container:document.body});this.clientId=t}onIframeLoadedInitVariables(){return i(this,null,function*(){let t=new c({clientId:this.clientId});return{authCookie:yield t.getAuthCookie(),deviceShareStored:yield t.getDeviceShare(),clientId:this.clientId}})}};function oe({clientId:a,path:e,queryParams:t}){var s;let r=new URL(e,C);if(r.searchParams.set("clientId",a),t)for(let n of Object.keys(t))r.searchParams.set(n,((s=t[n])==null?void 0:s.toString())||"");return r}var ne="paper-embedded-wallet-iframe";var S=class{constructor({clientId:e,querier:t,onAuthSuccess:r}){this.clientId=e,this.AuthQuerier=t,this.localStorage=new c({clientId:e}),this.onAuthSuccess=r}postLogin(r){return i(this,arguments,function*({storedToken:e,walletDetails:t}){return e.shouldStoreCookieString&&this.localStorage.saveAuthCookie(e.cookieString),yield this.onAuthSuccess({storedToken:e,walletDetails:t})})}loginWithJwtAuth(s){return i(this,arguments,function*({token:e,authProvider:t,recoveryCode:r}){let n=yield this.AuthQuerier.call({procedureName:"loginWithJwtAuthCallback",params:{token:e,authProvider:t,recoveryCode:r}});return this.postLogin(n)})}loginWithPaperModal(){return i(this,null,function*(){let e=yield this.AuthQuerier.call({procedureName:"loginWithPaperModal",params:void 0,showIframe:!0});return this.postLogin(e)})}loginWithPaperEmailOtp(t){return i(this,arguments,function*({email:e}){let r=yield this.AuthQuerier.call({procedureName:"loginWithPaperModal",params:{email:e},showIframe:!0});return this.postLogin(r)})}sendPaperEmailLoginOtp(t){return i(this,arguments,function*({email:e}){let{isNewUser:r}=yield this.AuthQuerier.call({procedureName:"sendPaperEmailLoginOtp",params:{email:e}});return{isNewUser:r}})}verifyPaperEmailLoginOtp(s){return i(this,arguments,function*({email:e,otp:t,recoveryCode:r}){let n=yield this.AuthQuerier.call({procedureName:"verifyPaperEmailLoginOtp",params:{email:e,otp:t,recoveryCode:r}});return this.postLogin(n)})}logout(){return i(this,null,function*(){let{success:e}=yield this.AuthQuerier.call({procedureName:"logout",params:void 0}),t=yield this.localStorage.removeAuthCookie(),r=yield this.localStorage.removeDeviceShare();return{success:e||t||r}})}};var V=require("@ethersproject/providers");var E=class{constructor({chain:e,clientId:t,querier:r}){this.chain=e,this.clientId=t,this.gaslessTransactionQuerier=r}callContract(s){return i(this,arguments,function*({contractAddress:e,methodArgs:t,methodInterface:r}){return yield this.gaslessTransactionQuerier.call({procedureName:"callContract",params:{chain:this.chain,contractAddress:e,method:{args:t,stub:r}}})})}};var z=require("@ethersproject/abstract-signer"),q=require("@ethersproject/properties");var g=class extends z.Signer{constructor({provider:t,clientId:r,querier:s}){super();this.DEFAULT_ETHEREUM_CHAIN_ID=1;this.clientId=r,this.querier=s,(0,q.defineReadOnly)(this,"provider",t)}getAddress(){return i(this,null,function*(){let{address:t}=yield this.querier.call({procedureName:"getAddress",params:void 0});return t})}signMessage(t){return i(this,null,function*(){var s,n,o;let{signedMessage:r}=yield this.querier.call({procedureName:"signMessage",params:{message:t,chainId:(o=(n=yield(s=this.provider)==null?void 0:s.getNetwork())==null?void 0:n.chainId)!=null?o:this.DEFAULT_ETHEREUM_CHAIN_ID}});return r})}signTransaction(t){return i(this,null,function*(){var s,n,o;let{signedTransaction:r}=yield this.querier.call({procedureName:"signTransaction",params:{transaction:t,chainId:(o=(n=yield(s=this.provider)==null?void 0:s.getNetwork())==null?void 0:n.chainId)!=null?o:this.DEFAULT_ETHEREUM_CHAIN_ID}});return r})}connect(t){return new g({clientId:this.clientId,provider:t,querier:this.querier})}};var D=class{constructor({clientId:e,chain:t,querier:r}){this.clientId=e,this.chain=t,this.walletManagerQuerier=r,this.gasless=new E({chain:t,clientId:e,querier:r}),this.localStorage=new c({clientId:e})}postWalletSetUp(s){return i(this,arguments,function*({deviceShareStored:e,walletAddress:t,isIframeStorageEnabled:r}){return r||this.localStorage.saveDeviceShare(e),{walletAddress:t}})}getUserWalletStatus(){return i(this,null,function*(){let e=yield this.walletManagerQuerier.call({procedureName:"getUserStatus",params:void 0});return e.status==="Logged In, Wallet Initialized"?{status:"Logged In, Wallet Initialized",user:y(u({},e.user),{wallet:this})}:e})}setChain(t){return i(this,arguments,function*({chain:e}){this.chain=e,this.gasless=new E({chain:e,clientId:this.clientId,querier:this.walletManagerQuerier})})}getEthersJsSigner(e){return i(this,null,function*(){var r;return new g({clientId:this.clientId,provider:(0,V.getDefaultProvider)((r=e==null?void 0:e.rpcEndpoint)!=null?r:R[this.chain]),querier:this.walletManagerQuerier})})}};var v=class{constructor({clientId:e,chain:t,styles:r}){this.clientId=e,this.querier=new w({clientId:e,customizationOptions:r}),this.wallet=new D({clientId:e,chain:t,querier:this.querier}),this.auth=new S({clientId:e,querier:this.querier,onAuthSuccess:s=>i(this,null,function*(){return yield this.wallet.postWalletSetUp(s.walletDetails),{user:{status:"Logged In, Wallet Initialized",authDetails:s.storedToken.authDetails,wallet:this.wallet,walletAddress:s.walletDetails.walletAddress}}})})}getUser(){return i(this,null,function*(){let e=yield this.wallet.getUserWalletStatus();switch(e.status){case"Logged In, New Device":case"Logged In, Wallet Uninitialized":return yield this.auth.logout(),this.getUser();case"Logged Out":return{status:"Logged Out"};case"Logged In, Wallet Initialized":return u({status:"Logged In, Wallet Initialized"},e.user)}})}};0&&(module.exports={AUTH_TOKEN_LOCAL_STORAGE_NAME,AUTH_TOKEN_LOCAL_STORAGE_PREFIX,AuthProvider,ChainToPublicRpc,DEVICE_SHARE_LOCAL_STORAGE_NAME,DEVICE_SHARE_LOCAL_STORAGE_PREFIX,EMBEDDED_WALLET_CREATE_WALLET_UI_PATH,EMBEDDED_WALLET_OTP_PATH,EMBEDDED_WALLET_PATH,EMBEDDED_WALLET_SET_UP_NEW_DEVICE_UI_PATH,PAPER_APP_URL,PaperEmbeddedWalletSdk,UserStatus,UserWalletStatus,getPaperOriginUrl});
